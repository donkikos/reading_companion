services:
  codex:
    build:
      context: .
      dockerfile: Dockerfile.codex
    image: epub_ai_reader_ralph_codex
    working_dir: /app
    init: true
    user: "pwuser"
    environment:
      CODEX_HOME: /codex
      QDRANT_HOST: qdrant
      TEI_BASE_URL: http://tei:80
      TEI_MODEL: ${TEI_MODEL:-BAAI/bge-base-en-v1.5}
      TEI_BATCH_SIZE: ${TEI_BATCH_SIZE:-8}
      TEI_TIMEOUT: ${TEI_TIMEOUT:-30}
    volumes:
      - ./:/app
      - ./.codex_container:/codex
      - ./skills:/codex/skills
    stdin_open: true
    tty: true
